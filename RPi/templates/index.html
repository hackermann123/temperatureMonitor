# v6.4 UPDATE - Per-Sensor Temperature Delta from Overall Average

## ðŸŽ‰ What's New

In the **Historical Graphs** tab, per-sensor statistics now show **how much each sensor deviates from the overall average temperature**.

### Visual Indicators
- **â†‘ Warmer** (Red) - Sensor is hotter than overall average
- **â†“ Cooler** (Green) - Sensor is cooler than overall average  
- **â‰ˆ Same** (Gray) - Sensor is at overall average

### Example
```
Overall Session Average: 22.50Â°C

Living Room:
â”œâ”€ Average: 23.15Â°C
â”œâ”€ vs Overall Avg: +0.65Â°C â†‘ Warmer (red)
â””â”€ Meaning: 0.65Â°C warmer than the building average

Kitchen:
â”œâ”€ Average: 22.50Â°C
â”œâ”€ vs Overall Avg: 0.00Â°C â‰ˆ Same (gray)
â””â”€ Meaning: Right at building average

Basement:
â”œâ”€ Average: 21.50Â°C
â”œâ”€ vs Overall Avg: -1.00Â°C â†“ Cooler (green)
â””â”€ Meaning: 1Â°C cooler than building average
```

---

## ðŸ“Š Display Details

### Per-Sensor Statistics Card (New)
Each sensor now shows:

1. **Minimum** - Coldest reading for this sensor
2. **Maximum** - Hottest reading for this sensor
3. **Average** - Mean temperature for this sensor
4. **Range** - Difference between min and max
5. **Vs Overall Avg** â† **NEW** - Delta from building average
   - Red arrow (â†‘) if warmer
   - Green arrow (â†“) if cooler
   - Gray line (â‰ˆ) if about the same

### Example Card
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LIVING ROOM                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Minimum    â”‚ Maximum   â”‚ Average â”‚
â”‚  21.50Â°C   â”‚  24.80Â°C  â”‚ 23.15Â°C â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Range              â”‚ Vs Overall  â”‚
â”‚  3.30Â°C            â”‚  +0.65Â°C    â”‚
â”‚                    â”‚  â†‘ Warmer   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¨ Color Coding

| Delta | Color | Icon | Meaning |
|-------|-------|------|---------|
| > +0.05Â°C | Red | â†‘ | Warmer than average |
| -0.05 to +0.05Â°C | Gray | â‰ˆ | At average |
| < -0.05Â°C | Green | â†“ | Cooler than average |

Threshold of Â±0.05Â°C prevents false positives from sensor noise.

---

## ðŸ“ˆ Use Cases

### 1. Identify Problem Areas
Find rooms that are consistently warmer/cooler:
```
Attic: +2.5Â°C warmer (poor insulation? sun exposure?)
Basement: -1.8Â°C cooler (needs insulation?)
Living Room: +0.3Â°C normal (good)
```

### 2. HVAC Effectiveness
Check if heating/cooling is evenly distributed:
```
If Kitchen is +2Â°C and Bedroom is -2Â°C â†’ Imbalanced system
If all within Â±0.5Â°C â†’ Well-balanced
```

### 3. Comfort Analysis
Track temperature consistency:
```
High variance (Â±1.5Â°C) â†’ Drafts, poor insulation
Low variance (Â±0.3Â°C) â†’ Good temperature control
```

### 4. Energy Optimization
Find where to focus improvements:
```
Consistently cold rooms â†’ Add insulation
Consistently hot rooms â†’ Improve ventilation
```

---

## ðŸ”§ Technical Details

### Calculation
```javascript
overallAverage = sum of all temperatures / count of all temperatures

For each sensor:
  sensorAverage = sum of sensor temps / count of sensor readings
  deltaFromAverage = sensorAverage - overallAverage
  
  If delta > 0.05:  "â†‘ Warmer" (Red)
  If delta < -0.05: "â†“ Cooler" (Green)
  Else:             "â‰ˆ Same" (Gray)
```

### Example Calculation
```
Session readings:
â”œâ”€ Room A: 20Â°C, 21Â°C, 22Â°C (avg: 21Â°C)
â”œâ”€ Room B: 23Â°C, 24Â°C, 25Â°C (avg: 24Â°C)
â””â”€ Room C: 21Â°C, 22Â°C, 23Â°C (avg: 22Â°C)

Overall average: (21 + 24 + 22) / 3 = 22.33Â°C

Room A: 21Â°C - 22.33Â°C = -1.33Â°C â†“ Cooler
Room B: 24Â°C - 22.33Â°C = +1.67Â°C â†‘ Warmer
Room C: 22Â°C - 22.33Â°C = -0.33Â°C â†“ Cooler
```

---

## ðŸ’¡ Interpreting the Data

### Example Session Report

```
OVERALL STATISTICS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Min:     19.5Â°C (coldest moment)
Max:     25.8Â°C (hottest moment)
Average: 22.4Â°C (mean)

PER-SENSOR BREAKDOWN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Living Room (4 readings)
â”œâ”€ Range: 22.1 - 23.8Â°C
â”œâ”€ Average: 22.95Â°C
â””â”€ Difference: +0.55Â°C â†‘ Warmer
   â†’ This room is warm (good for living, maybe adjust if too warm)

Kitchen (4 readings)
â”œâ”€ Range: 23.2 - 24.9Â°C
â”œâ”€ Average: 24.05Â°C
â””â”€ Difference: +1.65Â°C â†‘ Warmer
   â†’ Hot spot! Check for heat sources or poor insulation

Bedroom (4 readings)
â”œâ”€ Range: 20.8 - 21.5Â°C
â”œâ”€ Average: 21.15Â°C
â””â”€ Difference: -1.25Â°C â†“ Cooler
   â†’ Cool/cold - might need more heat or better insulation
```

**Interpretation:**
- Kitchen is 1.65Â°C hotter than average (investigate why)
- Bedroom is 1.25Â°C cooler than average (comfort issue?)
- Living room is slightly warm (pleasant)

---

## ðŸš€ Installation

Only the **HTML file** changed:

```bash
# Replace your index.html with v6.4
cp index_v6.4.html /path/to/templates/index.html

# Restart Flask
systemctl restart flask

# Hard refresh browser (Ctrl+F5 or Cmd+Shift+R)
```

**No other changes needed:**
- Python backend: unchanged
- Arduino: unchanged
- CSV logging: unchanged
- Everything else: works the same

---

## ðŸ“‹ Testing

1. Go to **Historical Graphs** tab
2. Click **Load Data**
3. Select a session with multiple sensors
4. Scroll down to "Per-Sensor Statistics"
5. You should see:
   - Each sensor's min/max/avg/range
   - **NEW:** "Vs Overall Avg" showing delta with color-coded indicator
   - Example: "+0.75Â°C â†‘ Warmer" in red

---

## âœ… Features

âœ… Automatic calculation (no manual input needed)
âœ… Color-coded visualization (red/green/gray)
âœ… Arrow indicators (â†‘ â†“ â‰ˆ)
âœ… Threshold-based (Â±0.05Â°C prevents noise)
âœ… Works with any number of sensors
âœ… No performance impact
âœ… 100% backward compatible

---

## ðŸŽ¯ Summary

**What you asked:** Show each sensor's average deviation from overall average  
**What we did:** Added delta calculation and color-coded visualization  
**Impact:** Easy identification of warm/cool spots in your building  
**Installation:** Just replace index.html  
**Result:** Better insights into temperature distribution! ðŸ“Š

---

## ðŸ“ž Questions?

The delta shows **how different each sensor is from the building average**:
- **Red â†‘**: Warmer than average â†’ Heat source or poor AC
- **Green â†“**: Cooler than average â†’ Less heating or good AC
- **Gray â‰ˆ**: About average â†’ Normal conditions

Use this to identify problem areas and optimize comfort/efficiency! ðŸ 
